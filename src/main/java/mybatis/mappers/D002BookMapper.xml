<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.book">
	<resultMap id="ClassResult" type="java.util.HashMap">
		<result property="building" column="bulName" />
        <result property="title" column="classNumber" />
        <result property="id" column="classId" />
        <result property="occupancy" column="classCapacity" />
     </resultMap> 
     
     <resultMap id="BookingResult" type="java.util.HashMap">
		<result property="id" column="bookNum" />
        <result property="resourceId" column="classId" />
        <result property="start" column="bookStartTime" />
        <result property="end" column="bookEndTime" />
        <result property="title" column="title" />
     </resultMap> 
     	
     <resultMap id="BookingInfo" type="java.util.HashMap">
     	<result property="id" column="bookNum"/>
     	
     </resultMap>    
     
     
     <select id="getClassList" resultMap="ClassResult">
     	<![CDATA[
     		SELECT 
			    C.CLASSNUMBER || '호' classNumber,
			    C.CLASSID classId,
			    C.CLASSCAPACITY classCapacity,
			    B.BULNAME bulName
			FROM CLASSROOM C, BUILDING B
			WHERE C.BULID = B.BULID
			ORDER BY C.BULID, C.CLASSID
     	]]>
     </select>
     
     <select id="getBookingList" resultMap="BookingResult">
	     <![CDATA[
	     	SELECT 
			    B.bookNum ,
			    B.classId ,
			    B.bookStartTime,
			    B.bookEndTime,
			    '(' || M.memName || ') ' || B.bookTitle as title
			FROM BOOKING B, MEMBER M
			WHERE B.MEMNUM=M.MEMNUM
				and B.bookCode = '1300'
		]]>
     </select>   
     
     <!-- 스터디실 예약자 번호  get -->
     <select id="getBookingMem" resultType="String" parameterType="String">
	     <![CDATA[
	     	SELECT 
			    B.memNum
			FROM BOOKING B
		]]>
		<where>
			<if test=" bookNum != ''  and  bookNum != null">
			<![CDATA[
				bookNum = #{bookNum}
			]]>
			</if>
		</where>
     </select>  
     
     <!-- 스터디실 예약 정보  get -->
     <select id="getBookingInfo" resultMap="BookingResult" parameterType="String">
	     <![CDATA[
	     	SELECT 
			    B.bookNum ,
			    B.classId ,
			    B.bookStartTime,
			    B.bookEndTime,
			    B.bookTitle as title
			FROM BOOKING B, MEMBER M
			WHERE B.MEMNUM=M.MEMNUM
				and B.bookCode = '1300'
		]]>
		<where>
			<if test=" bookNum != ''  and  bookNum != null">
			<![CDATA[
				bookNum = #{bookNum}
			]]>
			</if>
		</where>
     </select>  
</mapper>